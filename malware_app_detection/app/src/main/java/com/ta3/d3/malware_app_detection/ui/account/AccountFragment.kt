package com.ta3.d3.malware_app_detection.ui.account

import androidx.lifecycle.ViewModelProvider
import android.os.Bundle
import androidx.fragment.app.Fragment
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import androidx.fragment.app.activityViewModels
import androidx.navigation.fragment.findNavController
import com.ta3.d3.malware_app_detection.MyActivityViewModel
import com.ta3.d3.malware_app_detection.R
import com.ta3.d3.malware_app_detection.databinding.AccountFragmentBinding
import com.ta3.d3.malware_app_detection.db.AppDatabase
import com.ta3.d3.malware_app_detection.db.entities.User
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext

class AccountFragment : Fragment() {
    private var _binding : AccountFragmentBinding? = null
    private val binding get() = _binding!!
    val db by lazy { activity?.let { AppDatabase(it.applicationContext) } }

    private val model : MyActivityViewModel by activityViewModels()
    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
        _binding = AccountFragmentBinding.inflate(inflater, container, false)
        CoroutineScope(Dispatchers.IO).launch {
            var user = db!!.userDao().loadAllByIds(intArrayOf(1))[0]
            print(user.name)
            withContext(Dispatchers.Main){
                binding.etEmail.setText(user.email)
                binding.etName.setText(user.name)
                binding.etPhoneNumber.setText(user.phoneNumber)
            }
        }

        binding.btnEdit.setOnClickListener {
            findNavController().navigate(R.id.action_navigation_account_to_editProfileFragment)
        }
        return binding.root
    }

}